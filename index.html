      <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K-FRUITS SAGA</title>
  <style>
    body {
      margin: 0;
      background: url('https://i.imgur.com/8ZkLQ9r.jpg') center/cover fixed;
      color: #e0e0ff;
      font-family: 'Segoe UI', sans-serif;
      overflow-x: hidden;
      height: 100vh;
    }
    #loader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.95); display: flex; flex-direction: column;
      justify-content: center; align-items: center; z-index: 999;
    }
    #loader h1 {
      color: #ffcc00; font-size: 32px; margin-bottom: 20px;
      text-shadow: 0 0 15px rgba(255,204,0,0.9);
      letter-spacing: 2px;
    }
    #progress-bar {
      width: 240px; height: 12px; background: #0d0d20;
      border-radius: 6px; overflow: hidden;
      box-shadow: 0 0 12px rgba(255,204,0,0.4);
    }
    #progress {
      height: 100%; width: 0%; background: linear-gradient(90deg, #ffcc00, #ff9900);
      transition: width 0.5s ease;
    }
    #game {
      display: none; padding: 12px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }
    #header {
      display: flex; justify-content: space-between;
      margin-bottom: 15px; font-size: 20px;
      background: rgba(0,0,0,0.6); padding: 12px;
      border-radius: 12px;
      backdrop-filter: blur(4px);
    }
    #score { color: #ffcc00; font-weight: bold; }
    #target { color: #4dffcc; font-weight: bold; }
    #moves {
      display: flex; gap: 6px; margin: 15px 0;      justify-content: center;
    }
    .move-fruit {
      width: 24px; height: 24px; background: #ffcc00;
      border-radius: 50%; box-shadow: 0 0 8px rgba(255,204,0,0.7);
    }
    #board {
      display: grid; grid-template-columns: repeat(5, 1fr);
      gap: 6px; margin: 15px 0;
    }
    .cell {
      aspect-ratio: 1; background: rgba(10,10,20,0.7);
      border-radius: 12px; display: flex;
      justify-content: center; align-items: center;
      font-size: 26px;
      backdrop-filter: blur(2px);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .cell:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(100,200,255,0.5);
    }
    #tools {
      display: flex; justify-content: space-around;
      margin-top: 20px;
    }
    .tool {
      width: 50px; height: 50px; background: rgba(40,40,60,0.85);
      border-radius: 50%; display: flex;
      justify-content: center; align-items: center;
      color: white; font-weight: bold;
      font-size: 24px;
      box-shadow: 0 0 12px rgba(100,200,255,0.3);
      transition: all 0.3s;
    }
    .tool:active {
      transform: scale(0.9);
      box-shadow: 0 0 15px rgba(255,204,0,0.6);
    }
    #level-select {
      text-align: center; margin-top: 25px;
      color: #aaa; font-size: 16px;
      text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    .combo-effect {
      animation: pulse 0.4s;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }      100% { transform: scale(1); }
    }
  </style>
</head>
<body>

<audio id="ambience" loop>
  <source src="https://www.soundjay.com/nature/sounds/wind-blowing-soft-01.mp3" type="audio/mpeg">
</audio>

<div id="loader">
  <h1>K-FRUITS SAGA</h1>
  <div id="progress-bar"><div id="progress"></div></div>
</div>

<div id="game">
  <div id="header">
    <div>Puntos: <span id="score">0000</span></div>
    <div>Objetivo: <span id="target">20</span></div>
  </div>

  <div id="moves">
    <!-- 15 toques -->
  </div>

  <div id="board">
    <!-- Tablero se genera con JS -->
  </div>

  <div id="tools">
    <div class="tool">üå±</div>
    <div class="tool">üçì</div>
    <div class="tool">üîÑ</div>
  </div>

  <div id="level-select">
    Nivel 1 | Mundo: RA√çZ | Tablero: 5√ó5
  </div>
</div>

<script>
// === CONFIGURACI√ìN ===
const FRUITS = ['üçé', 'üçì', 'üçå', 'ü•ù', 'üçá', 'ü•ë', 'ü•≠', 'üçç'];
let score = 0;
let target = 20;
let movesLeft = 15;
let boardSize = { rows: 5, cols: 5 };
let board = [];
let selectedCell = null;
let isAnimating = false;
// === INICIALIZAR JUEGO ===
function initGame() {
  document.getElementById('score').textContent = '0000';
  document.getElementById('target').textContent = target;
  document.getElementById('level-select').textContent = 
    `Nivel 1 | Mundo: RA√çZ | Tablero: ${boardSize.rows}√ó${boardSize.cols}`;

  const boardEl = document.getElementById('board');
  boardEl.innerHTML = '';

  // Generar tablero SIN combinaciones iniciales
  board = [];
  for (let r = 0; r < boardSize.rows; r++) {
    board[r] = [];
    for (let c = 0; c < boardSize.cols; c++) {
      let fruit;
      do {
        fruit = FRUITS[Math.floor(Math.random() * FRUITS.length)];
      } while (createsInitialCombo(r, c, fruit));
      board[r][c] = fruit;
      
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.textContent = fruit;
      cell.dataset.row = r;
      cell.dataset.col = c;
      cell.addEventListener('touchstart', handleTouchStart);
      cell.addEventListener('mousedown', handleTouchStart);
      boardEl.appendChild(cell);
    }
  }

  // 15 toques
  const movesEl = document.getElementById('moves');
  movesEl.innerHTML = '';
  for (let i = 0; i < movesLeft; i++) {
    const fruit = document.createElement('div');
    fruit.className = 'move-fruit';
    fruit.style.background = '#ffcc00';
    movesEl.appendChild(fruit);
  }
}

// === VERIFICAR COMBO INICIAL ===
function createsInitialCombo(row, col, fruit) {
  if (col >= 2 && board[row][col-1] === fruit && board[row][col-2] === fruit) return true;
  if (col >= 1 && col < boardSize.cols-1 && board[row][col-1] === fruit && board[row][col+1] === fruit) return true;
  if (col < boardSize.cols-2 && board[row][col+1] === fruit && board[row][col+2] === fruit) return true;
  if (row >= 2 && board[row-1][col] === fruit && board[row-2][col] === fruit) return true;  if (row >= 1 && row < boardSize.rows-1 && board[row-1][col] === fruit && board[row+1][col] === fruit) return true;
  if (row < boardSize.rows-2 && board[row+1][col] === fruit && board[row+2][col] === fruit) return true;
  return false;
}

// === TOQUE ===
function handleTouchStart(e) {
  if (isAnimating) return;
  e.preventDefault();
  const cell = e.target;
  if (!cell.classList.contains('cell')) return;
  const r = parseInt(cell.dataset.row);
  const c = parseInt(cell.dataset.col);
  selectedCell = { r, c };
  cell.classList.add('pulse-effect');
  setTimeout(() => cell.classList.remove('pulse-effect'), 300);
}

// === SIMULAR COMBO ===
document.getElementById('board').addEventListener('click', function(e) {
  if (isAnimating || !selectedCell) return;
  const cell = e.target;
  if (!cell.classList.contains('cell')) return;
  simulateCombo(selectedCell.r, selectedCell.c);
});

function simulateCombo(row, col) {
  isAnimating = true;
  const boardEl = document.getElementById('board');
  const cellsToClear = [];
  const fruit = board[row][col];
  let count = 1;

  // Horizontal
  for (let c = col-1; c >= 0 && board[row][c] === fruit; c--) count++;
  for (let c = col+1; c < boardSize.cols && board[row][c] === fruit; c++) count++;
  if (count >= 3) {
    const start = col - Math.floor((count-1)/2);
    for (let i = 0; i < count; i++) {
      const c = start + i;
      if (c >= 0 && c < boardSize.cols) cellsToClear.push({r: row, c});
    }
  }

  // Vertical
  if (cellsToClear.length < 3) {
    count = 1;
    for (let r = row-1; r >= 0 && board[r][col] === fruit; r--) count++;
    for (let r = row+1; r < boardSize.rows && board[r][col] === fruit; r++) count++;
    if (count >= 3) {      const start = row - Math.floor((count-1)/2);
      for (let i = 0; i < count; i++) {
        const r = start + i;
        if (r >= 0 && r < boardSize.rows) cellsToClear.push({r, c: col});
      }
    }
  }

  if (cellsToClear.length >= 3) {
    cellsToClear.forEach(pos => {
      const idx = pos.r * boardSize.cols + pos.c;
      const cell = boardEl.children[idx];
      cell.classList.add('combo-effect');
      setTimeout(() => {
        cell.textContent = '';
        cell.style.background = 'rgba(20,20,40,0.5)';
      }, 200);
    });

    const pts = cellsToClear.length === 3 ? 3 : cellsToClear.length === 4 ? 5 : 8;
    score += pts;
    document.getElementById('score').textContent = String(score).padStart(4, '0');

    if (fruit === 'üçå') {
      target -= cellsToClear.length;
      if (target < 0) target = 0;
      document.getElementById('target').textContent = target;
    }

    setTimeout(() => {
      dropFruits();
      isAnimating = false;
    }, 500);
  }
}

// === CA√çDA ===
function dropFruits() {
  const boardEl = document.getElementById('board');
  for (let c = 0; c < boardSize.cols; c++) {
    let empty = [];
    for (let r = boardSize.rows - 1; r >= 0; r--) {
      const idx = r * boardSize.cols + c;
      const cell = boardEl.children[idx];
      if (cell.textContent === '') empty.push(r);
      else if (empty.length > 0) {
        const last = empty.pop();
        const fruit = cell.textContent;
        cell.textContent = '';
        boardEl.children[last * boardSize.cols + c].textContent = fruit;        boardEl.children[last * boardSize.cols + c].classList.add('combo-effect');
        setTimeout(() => {
          boardEl.children[last * boardSize.cols + c].classList.remove('combo-effect');
        }, 300);
      }
    }
    for (let i = 0; i < empty.length; i++) {
      const r = empty[i];
      const fruit = FRUITS[Math.floor(Math.random() * FRUITS.length)];
      boardEl.children[r * boardSize.cols + c].textContent = fruit;
      boardEl.children[r * boardSize.cols + c].classList.add('combo-effect');
      setTimeout(() => {
        boardEl.children[r * boardSize.cols + c].classList.remove('combo-effect');
      }, 300);
    }
  }
}

// === CARGA ===
window.addEventListener('load', () => {
  let p = 0;
  const bar = document.getElementById('progress');
  const loader = document.getElementById('loader');
  const game = document.getElementById('game');

  const interval = setInterval(() => {
    p += 1.2;
    bar.style.width = Math.min(p, 100) + '%';
    if (p >= 100) {
      clearInterval(interval);
      setTimeout(() => {
        loader.style.display = 'none';
        game.style.display = 'block';
        initGame();
      }, 400);
    }
  }, 35);

  document.body.addEventListener('touchstart', () => {
    const a = document.getElementById('ambience');
    a.volume = 0.15;
    a.play().catch(() => {});
  }, { once: true });
});
</script>
</body>
</html>
